# 动态库
（共享库）

## 描述

### 机制

- 共享库的代码是在可执行程序运行时才载入内存的，在编译过程中仅简单的引用，因此代码体积较小。

### 优点

- 节省内存（共享）
- 易于更新（动态链接）

	- 停止运行程序
	- 使用新库覆盖旧库(保证新旧库名称一致，接口一致) “接口”
	- 重新启动程序。

### 缺点

- 延时绑定，速度略慢

### 使用场合

- 对速度要求不是很强烈的地方都应使用动态库

### 注意事项

- 动态库是否加载到内存，取决于程序是否运行。

## 命名格式

### lib开头

### 动态库名

### .so 结尾

## 制作

### 生成“与位置无关”的目标文件

- gcc -fPIC a.c b.c c.c -c

	- 参数 -fPIC 表示生成与位置无关代码
	- 执行完毕后生成一系列的 .o 文件

### 制作动态库

- gcc -shared -o libmytest.so a.o b.o c.o

	- 参数：-shared 制作动态库
	- -o：重命名生成的新文件

### 使用动态库

- gcc main.c -L./ -lmytest -I./ -o app

	- -L --> 指定库所在的路径
	- 去掉前缀 lib
	- 去掉后缀 .so
	- 只留下中间部分
	- -I --> 头文件目录位置

### 执行生成的可执行文件

- ./app --> 运行失败

	- 查看依赖的共享库：ldd app 发现 libmytest 找不到
	- 没有给动态链接器（ld-linux.so.2）指定好动态库 libmytest.so 的路径
	- 解决方案

		- 1. 临时设置：export LD_LIBRARY_PATH=库路径，将当前目录加入环境变量，但是终端退出了就无效了。
		- 2. 永久设置：将上条写入家目录下.bashrc文件中
		- 3. 粗暴设置：直接将libmytest.so文件拷贝到/usr/lib/【/lib】目录下。(受libc库的启发)
		- 4. 将libmytest.so所在绝对路径追加入到/etc/ld.so.conf文件，
   使用sudo ldconfig -v 更新

## LD_LIBRARY_PATH

### 作用

- 指定查找共享库（动态链接库）时除了默认路径之外的其他路径
- 该路径在默认路径之前查找

### 设置方法

- 用export命令来设置值

*XMind - Trial Version*